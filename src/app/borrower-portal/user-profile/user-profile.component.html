<div class="container mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Thông tin cá nhân</h1>
        <p class="text-gray-600 mt-2">Xem và quản lý thông tin tài khoản của bạn</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
        <div class="flex flex-col items-center">
            <svg class="animate-spin h-10 w-10 text-[#E74C3C] mb-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <p class="text-gray-600">Đang tải thông tin...</p>
        </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-md">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-red-700">{{ error }}</p>
                <button (click)="loadUserProfile()"
                    class="mt-2 text-sm font-medium text-red-700 hover:text-red-600 focus:outline-none">
                    Thử lại
                </button>
            </div>
        </div>
    </div>

    <!-- User Profile Content -->
    <div *ngIf="userProfile && !isLoading" class="fade-in">
        <!-- User Header Card -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div class="flex flex-col md:flex-row items-center md:items-start">
                <!-- Profile Avatar -->
                <div
                    class="w-24 h-24 rounded-full bg-[#E74C3C] flex items-center justify-center text-white text-3xl font-bold shadow-md mb-4 md:mb-0 md:mr-6">
                    {{ userProfile.fullName ? userProfile.fullName.charAt(0).toUpperCase() : 'U' }}
                </div>

                <!-- User Basic Info -->
                <div class="text-center md:text-left flex-1">
                    <h2 class="text-2xl font-bold text-gray-800">{{ userProfile.fullName }}</h2>
                    <p class="text-gray-600 mb-3">{{ userProfile.email }}</p>

                    <div class="flex flex-wrap justify-center md:justify-start gap-3 mt-2">
                        <span
                            class="px-3 py-1 bg-[#E74C3C]/10 text-[#E74C3C] rounded-full text-xs font-medium flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            Người dùng
                        </span>
                        <span *ngIf="userProfile.id"
                            class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                            </svg>
                            ID: {{ userProfile.id }}
                        </span>
                    </div>
                </div>

                <!-- Edit Button -->
                <div class="mt-4 md:mt-0">
                    <button (click)="showEditModal()"
                        class="px-4 py-2 border border-gray-300 rounded-md text-gray-600 hover:bg-gray-50 hover:text-[#E74C3C] transition-colors duration-300 flex items-center shadow-sm hover:shadow">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        Chỉnh sửa
                    </button>
                </div>
            </div>
        </div>

        <!-- Detailed Information -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Contact Information -->
            <div class="col-span-1 md:col-span-2">
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C] mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-800">Thông tin liên hệ</h3>
                    </div>
                    <div class="divide-y divide-gray-200">
                        <!-- Email -->
                        <div class="py-3 grid grid-cols-1 md:grid-cols-3">
                            <div class="text-sm font-medium text-gray-500">Email</div>
                            <div class="md:col-span-2 text-gray-800 font-medium">{{ userProfile.email || 'Chưa cung cấp'
                                }}</div>
                        </div>

                        <!-- Phone Number -->
                        <div class="py-3 grid grid-cols-1 md:grid-cols-3">
                            <div class="text-sm font-medium text-gray-500">Số điện thoại</div>
                            <div class="md:col-span-2 text-gray-800 font-medium">
                                <div class="flex items-center">
                                    <svg *ngIf="userProfile.phoneNumber" xmlns="http://www.w3.org/2000/svg"
                                        class="h-4 w-4 text-green-600 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    {{ userProfile.phoneNumber || 'Chưa cung cấp' }}
                                </div>
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="py-3 grid grid-cols-1 md:grid-cols-3">
                            <div class="text-sm font-medium text-gray-500">Địa chỉ</div>
                            <div class="md:col-span-2 text-gray-800 font-medium">{{ userProfile.address || 'Chưa cung
                                cấp' }}</div>
                        </div>
                    </div>
                </div>

                <!-- Account Information -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C] mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-800">Thông tin tài khoản</h3>
                    </div>
                    <div class="divide-y divide-gray-200">
                        <!-- Account ID -->
                        <div class="py-3 grid grid-cols-1 md:grid-cols-3" *ngIf="userProfile.id">
                            <div class="text-sm font-medium text-gray-500">ID tài khoản</div>
                            <div class="md:col-span-2 text-gray-800 font-medium">{{ userProfile.id }}</div>
                        </div>

                        <!-- Password -->
                        <div class="py-3 grid grid-cols-1 md:grid-cols-3">
                            <div class="text-sm font-medium text-gray-500">Mật khẩu</div>
                            <div class="md:col-span-2 flex items-center">
                                <span class="text-gray-800 mr-2">••••••••</span>
                                <button (click)="showPasswordModal()"
                                    class="text-xs rounded-lg border-gray-100 text-[#E74C3C] hover:text-[#C0392B] font-medium focus:outline-none transition-colors duration-300">
                                    Đổi mật khẩu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="col-span-1">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C] mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <h3 class="text-xl font-semibold text-gray-800">Thao tác nhanh</h3>
                    </div>

                    <div class="space-y-3">
                        <a routerLink="/borrower-portal/loan-application-form"
                            class="flex items-center p-3 rounded-lg border border-gray-200 hover:border-[#E74C3C] transition-colors duration-300 group">
                            <div
                                class="w-10 h-10 rounded-full bg-[#E74C3C]/10 flex items-center justify-center mr-3 group-hover:bg-[#E74C3C]/20 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C]" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-800 group-hover:text-[#E74C3C]">Đăng ký khoản
                                    vay</h4>
                                <p class="text-xs text-gray-500">Tạo yêu cầu vay mới</p>
                            </div>
                        </a>

                        <a routerLink="/borrower-portal/application-list"
                            class="flex items-center p-3 rounded-lg border border-gray-200 hover:border-[#E74C3C] transition-colors duration-300 group">
                            <div
                                class="w-10 h-10 rounded-full bg-[#E74C3C]/10 flex items-center justify-center mr-3 group-hover:bg-[#E74C3C]/20 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C]" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-800 group-hover:text-[#E74C3C]">Khoản vay của
                                    tôi</h4>
                                <p class="text-xs text-gray-500">Xem trạng thái khoản vay</p>
                            </div>
                        </a>

                        <a routerLink="/borrower-portal/notification-list"
                            class="flex items-center p-3 rounded-lg border border-gray-200 hover:border-[#E74C3C] transition-colors duration-300 group">
                            <div
                                class="w-10 h-10 rounded-full bg-[#E74C3C]/10 flex items-center justify-center mr-3 group-hover:bg-[#E74C3C]/20 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C]" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-800 group-hover:text-[#E74C3C]">Thông báo</h4>
                                <p class="text-xs text-gray-500">Xem thông báo của bạn</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Contact Information Modal -->
    <nz-modal [(nzVisible)]="isEditModalVisible" [nzTitle]="editModalTitle" (nzOnCancel)="handleEditCancel()"
        [nzOkText]="'Lưu thay đổi'" [nzCancelText]="'Hủy'" [nzOkLoading]="isSubmitting" [nzOkType]="'primary'"
        [nzOkDanger]="true" [nzMaskClosable]="false" [nzWidth]="520" nzCentered (nzOnOk)="submitEditForm()">

        <ng-template #editModalTitle>
            <div class="flex items-center text-[#E74C3C]">
                <div class="w-8 h-8 rounded-full bg-[#E74C3C]/10 flex items-center justify-center mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C]" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                </div>
                <span class="text-lg font-medium">Chỉnh sửa thông tin cá nhân</span>
            </div>
        </ng-template>

        <ng-container *nzModalContent>
            <!-- Introduction text -->
            <div class="bg-gradient-to-r from-[#E74C3C]/5 to-gray-50 -mx-6 px-6 py-4 mb-6 border-b border-gray-200">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C] mr-2" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="text-gray-700 text-sm">Cập nhật thông tin cá nhân của bạn. Đảm bảo thông tin chính xác để
                        được hỗ trợ tốt nhất.</p>
                </div>
            </div>

            <form nz-form [formGroup]="editForm" class="px-2">
                <!-- Full Name -->
                <nz-form-item class="mb-5">
                    <nz-form-label [nzSm]="7" [nzXs]="24" nzFor="fullName" nzRequired class="font-medium">
                        <span class="flex items-center">
                            Họ tên
                        </span>
                    </nz-form-label>
                    <nz-form-control [nzSm]="17" [nzXs]="24" nzErrorTip="Vui lòng nhập họ tên!">
                        <nz-input-group [nzPrefix]="userIcon"
                            class="rounded-md shadow-sm hover:shadow transition-all duration-300">
                            <input nz-input formControlName="fullName" id="fullName" placeholder="Nhập họ tên"
                                class="py-2.5" />
                        </nz-input-group>
                        <ng-template #userIcon>
                            <span class="text-[#E74C3C] pl-3 pr-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </span>
                        </ng-template>
                    </nz-form-control>
                </nz-form-item>

                <!-- Phone Number -->
                <nz-form-item class="mb-5">
                    <nz-form-label [nzSm]="7" [nzXs]="24" nzFor="phoneNumber" class="font-medium">
                        <span class="flex items-center">
                            Số điện thoại
                        </span>
                    </nz-form-label>
                    <nz-form-control [nzSm]="17" [nzXs]="24" [nzErrorTip]="phoneNumberErrorTpl">
                        <nz-input-group [nzPrefix]="phoneIcon"
                            class="rounded-md shadow-sm hover:shadow transition-all duration-300">
                            <input nz-input formControlName="phoneNumber" id="phoneNumber"
                                placeholder="Nhập số điện thoại" class="py-2.5" />
                        </nz-input-group>
                        <ng-template #phoneIcon>
                            <span class="text-[#E74C3C] pl-3 pr-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                            </span>
                        </ng-template>
                        <ng-template #phoneNumberErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('pattern')">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-red-500 mr-1"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Số điện thoại không hợp lệ!
                                </div>
                            </ng-container>
                        </ng-template>
                        <div class="text-xs text-gray-500 mt-1 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Nhập số điện thoại từ 9-11 chữ số, không bao gồm dấu hoặc khoảng trắng
                        </div>
                    </nz-form-control>
                </nz-form-item>

                <!-- Address -->
                <nz-form-item>
                    <nz-form-label [nzSm]="7" [nzXs]="24" nzFor="address" class="font-medium">
                        <span class="flex items-center">
                            Địa chỉ
                        </span>
                    </nz-form-label>
                    <nz-form-control [nzSm]="17" [nzXs]="24">
                        <nz-input-group [nzPrefix]="addressIcon"
                            class="rounded-md shadow-sm hover:shadow transition-all duration-300">
                            <textarea nz-input formControlName="address" id="address" placeholder="Nhập địa chỉ"
                                [nzAutosize]="{ minRows: 2, maxRows: 6 }" class="py-2.5 pl-10"></textarea>
                        </nz-input-group>
                        <ng-template #addressIcon>
                            <span class="text-[#E74C3C] pl-3 pr-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </span>
                        </ng-template>
                    </nz-form-control>
                </nz-form-item>
            </form>

            <!-- Information section -->
            <div class="grid grid-cols-1 gap-4 my-4">
                <!-- Privacy note -->
                <div
                    class="bg-blue-50 rounded-md p-4 border-l-4 border-blue-400 transition-all hover:shadow-md duration-300">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-blue-800">Bảo mật thông tin</h3>
                            <div class="mt-1 text-sm text-blue-700">
                                <p>Thông tin của bạn sẽ được bảo mật và chỉ sử dụng để liên hệ về khoản vay.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact info importance -->
                <div
                    class="bg-amber-50 rounded-md p-4 border-l-4 border-amber-400 transition-all hover:shadow-md duration-300">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-amber-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-amber-800">Lưu ý quan trọng</h3>
                            <div class="mt-1 text-sm text-amber-700">
                                <p>Đảm bảo cung cấp thông tin liên hệ chính xác để nhận được thông báo kịp thời về khoản
                                    vay của bạn.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </nz-modal>

    <!-- Change Password Modal -->
    <nz-modal [(nzVisible)]="isPasswordModalVisible" [nzTitle]="passwordModalTitle"
        (nzOnCancel)="handlePasswordCancel()" [nzOkText]="'Lưu thay đổi'" [nzCancelText]="'Hủy'"
        [nzOkLoading]="isSubmitting" [nzOkType]="'primary'" [nzOkDanger]="true" [nzMaskClosable]="false" [nzWidth]="520"
        nzCentered (nzOnOk)="submitPasswordForm()">

        <ng-template #passwordModalTitle>
            <div class="flex items-center text-[#E74C3C]">
                <div class="w-8 h-8 rounded-full bg-[#E74C3C]/10 flex items-center justify-center mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C]" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <span class="text-lg font-medium">Đổi mật khẩu</span>
            </div>
        </ng-template>

        <ng-container *nzModalContent>
            <!-- Introduction text -->
            <div class="bg-gradient-to-r from-[#E74C3C]/5 to-gray-50 -mx-6 px-6 py-4 mb-6 border-b border-gray-200">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#E74C3C] mr-2" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="text-gray-700 text-sm">Thay đổi mật khẩu tài khoản của bạn. Đảm bảo sử dụng mật khẩu mạnh
                        để bảo vệ tài khoản.</p>
                </div>
            </div>

            <form nz-form [formGroup]="passwordForm" class="px-2">
                <!-- New Password -->
                <nz-form-item class="mb-5">
                    <nz-form-label [nzSm]="8" [nzXs]="24" nzFor="password" nzRequired class="font-medium">
                        <span class="flex items-center">
                            Mật khẩu mới
                        </span>
                    </nz-form-label>
                    <nz-form-control [nzSm]="16" [nzXs]="24" [nzErrorTip]="passwordErrorTpl">
                        <nz-input-group [nzPrefix]="lockIcon" [nzSuffix]="showPasswordIcon"
                            class="rounded-md shadow-sm hover:shadow transition-all duration-300">
                            <input nz-input [type]="showPassword ? 'text' : 'password'" formControlName="password"
                                id="password" placeholder="Nhập mật khẩu mới" class="py-2.5"
                                (input)="checkPasswordStrength()" />
                        </nz-input-group>
                        <ng-template #lockIcon>
                            <span class="text-[#E74C3C] pl-3 pr-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                            </span>
                        </ng-template>
                        <ng-template #showPasswordIcon>
                            <span
                                class="cursor-pointer text-gray-500 hover:text-[#E74C3C] transition-colors duration-300 pr-3"
                                (click)="showPassword = !showPassword">
                                <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                                <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                                </svg>
                            </span>
                        </ng-template>
                        <ng-template #passwordErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-red-500 mr-1"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Vui lòng nhập mật khẩu mới!
                                </div>
                            </ng-container>
                            <ng-container *ngIf="control.hasError('minlength')">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-red-500 mr-1"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Mật khẩu phải có ít nhất 6 ký tự!
                                </div>
                            </ng-container>
                        </ng-template>

                        <!-- Password Strength Indicator -->
                        <div *ngIf="passwordForm.get('password')?.value?.length > 0" class="mt-2">
                            <div class="flex items-center mb-1 mt-1">
                                <span class="text-xs font-medium mr-2 text-gray-700">Độ mạnh:</span>
                                <span *ngIf="passwordStrength === 'weak'"
                                    class="password-strength-badge password-weak">Yếu</span>
                                <span *ngIf="passwordStrength === 'medium'"
                                    class="password-strength-badge password-medium">Trung bình</span>
                                <span *ngIf="passwordStrength === 'strong'"
                                    class="password-strength-badge password-strong">Mạnh</span>
                            </div>
                            <div class="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                <div [ngClass]="{
                                    'bg-red-500': passwordStrength === 'weak',
                                    'bg-yellow-500': passwordStrength === 'medium',
                                    'bg-green-500': passwordStrength === 'strong'
                                }" [style.width]="
                                    passwordStrength === 'weak' ? '30%' :
                                    passwordStrength === 'medium' ? '60%' :
                                    '100%'
                                " class="h-full transition-all duration-300"></div>
                            </div>
                        </div>
                    </nz-form-control>
                </nz-form-item>

                <!-- Confirm Password -->
                <nz-form-item>
                    <nz-form-label [nzSm]="8" [nzXs]="24" nzFor="confirmPassword" nzRequired class="font-medium">
                        <span class="flex items-center">
                            Xác nhận mật khẩu
                        </span>
                    </nz-form-label>
                    <nz-form-control [nzSm]="16" [nzXs]="24" [nzErrorTip]="confirmPasswordErrorTpl">
                        <nz-input-group [nzPrefix]="confirmLockIcon"
                            class="rounded-md shadow-sm hover:shadow transition-all duration-300">
                            <input nz-input [type]="showPassword ? 'text' : 'password'"
                                formControlName="confirmPassword" id="confirmPassword"
                                placeholder="Nhập lại mật khẩu mới" class="py-2.5" />
                        </nz-input-group>
                        <ng-template #confirmLockIcon>
                            <span class="text-[#E74C3C] pl-3 pr-1 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </span>
                        </ng-template>
                        <ng-template #confirmPasswordErrorTpl let-control>
                            <ng-container *ngIf="control.hasError('required')">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-red-500 mr-1"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Vui lòng xác nhận mật khẩu!
                                </div>
                            </ng-container>
                            <ng-container *ngIf="passwordForm.hasError('mismatch')">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-red-500 mr-1"
                                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Mật khẩu xác nhận không khớp!
                                </div>
                            </ng-container>
                        </ng-template>
                    </nz-form-control>
                </nz-form-item>
            </form>

            <!-- Password strength tips -->
            <div class="mt-6 mb-3 bg-gray-50 rounded-lg p-4 border border-gray-100">
                <h4 class="text-sm font-medium mb-3 text-gray-700 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-[#E74C3C]" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    Mật khẩu mạnh nên có:
                </h4>
                <ul class="space-y-2">
                    <li class="flex items-center text-sm text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Ít nhất 8 ký tự
                    </li>
                    <li class="flex items-center text-sm text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Chữ hoa và chữ thường
                    </li>
                    <li class="flex items-center text-sm text-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500 mr-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Số và ký tự đặc biệt
                    </li>
                </ul>
            </div>

            <!-- Security tips -->
            <div class="grid grid-cols-1 gap-4 my-4">
                <div
                    class="bg-amber-50 rounded-md p-4 border-l-4 border-amber-400 transition-all hover:shadow-md duration-300">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-amber-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-amber-800">Lưu ý bảo mật</h3>
                            <div class="mt-1 text-sm text-amber-700">
                                <p>Vui lòng không chia sẻ mật khẩu của bạn với bất kỳ ai. Hệ thống sẽ không bao giờ yêu
                                    cầu mật khẩu của bạn qua email hoặc điện thoại.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="bg-green-50 rounded-md p-4 border-l-4 border-green-400 transition-all hover:shadow-md duration-300">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                    clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">Mẹo bảo mật</h3>
                            <div class="mt-1 text-sm text-green-700">
                                <p>Thay đổi mật khẩu thường xuyên và không sử dụng mật khẩu đã dùng cho các tài khoản
                                    khác sẽ giúp bảo vệ thông tin cá nhân của bạn tốt hơn.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </nz-modal>
</div>